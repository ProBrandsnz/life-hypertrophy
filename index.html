<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypertrophy OS - Accountability Robot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #faf7f2;
            color: #2f2f2f;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, #8fbc8f, #6b8e23);
            color: white;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background-color: #f5f1eb;
            border-radius: 10px;
            padding: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            margin: 0 5px;
            background-color: #8fbc8f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background-color: #6b8e23;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background-color: #d2691e;
        }

        .tab-content {
            display: none;
            background-color: #f5f1eb;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #8fbc8f;
        }

        .foundation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .foundation-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            border-left: 4px solid #8fbc8f;
        }

        .foundation-item.completed {
            border-left-color: #d4a5a5;
            background-color: #f8f8f8;
        }

        .foundation-item.missed {
            border-left-color: #d2691e;
            background-color: #fff5f5;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            margin-left: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background-color: #8fbc8f;
            color: white;
        }

        .btn-primary:hover {
            background-color: #6b8e23;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: #d2691e;
            color: white;
        }

        .btn-success {
            background-color: #d4a5a5;
            color: white;
        }

        .question-group {
            margin-bottom: 25px;
        }

        .question-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            color: #2f2f2f;
        }

        .question-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d4a5a5;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
        }

        .flame-card {
            background: linear-gradient(135deg, #d2691e, #8fbc8f);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .flame-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .flame-card.selected {
            border-color: #faf7f2;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .flame-category {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .accountability-alert {
            background-color: #d2691e;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .performance-item {
            text-align: center;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            border-top: 4px solid #8fbc8f;
        }

        .rating-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #8fbc8f;
            background-color: white;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .rating-btn:hover {
            background-color: #8fbc8f;
            color: white;
        }

        .rating-btn.selected {
            background-color: #d4a5a5;
            color: white;
            border-color: #d4a5a5;
        }

        .export-section {
            background-color: #6b8e23;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }

        .weight-progress {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #8fbc8f, #d4a5a5);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .foundation-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        .time-display {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #6b8e23;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-complete { background-color: #d4a5a5; }
        .status-incomplete { background-color: #d2691e; }
        .status-pending { background-color: #8fbc8f; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🔥 HYPERTROPHY OS - ACCOUNTABILITY ROBOT 🔥</h1>
            <p>Transform or stay mediocre. Your choice. Your life depends on it.</p>
            <div class="time-display" id="currentTime"></div>
        </header>

        <div class="weight-progress" id="weightProgress">
            Current: 105kg → Target: 98kg | Progress: 0% Complete
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('morning')">Morning Ritual</button>
            <button class="nav-tab" onclick="switchTab('dashboard')">Daily Dashboard</button>
            <button class="nav-tab" onclick="switchTab('evening')">Evening Ritual</button>
            <button class="nav-tab" onclick="switchTab('planning')">Night Planning</button>
            <button class="nav-tab" onclick="switchTab('export')">Analysis Export</button>
        </nav>

        <!-- Morning Ritual Tab -->
        <div id="morning" class="tab-content active">
            <div class="card">
                <h2>🌅 Morning Ritual - Foundation Setup</h2>
                <p><strong>Time to set your intentions and commit to excellence. No excuses, no shortcuts.</strong></p>
                
                <div class="question-group">
                    <label class="question-label">Current Weight (kg):</label>
                    <input type="number" id="currentWeight" class="question-input" style="min-height: 40px;" placeholder="Enter your weight">
                </div>

                <div class="question-group">
                    <label class="question-label">Training Day? (affects calorie target)</label>
                    <select id="trainingDay" class="question-input" style="min-height: 40px;">
                        <option value="training">Training Day (2475 calories)</option>
                        <option value="rest">Rest Day (2223 calories)</option>
                    </select>
                </div>

                <div class="question-group">
                    <label class="question-label">Which workout are you doing today? (if training day)</label>
                    <select id="workoutType" class="question-input" style="min-height: 40px;">
                        <option value="">Select workout</option>
                        <option value="lower1">Lower 1: 13 working sets (machine-focused legs)</option>
                        <option value="pushDay">Upper (Push): 14 working sets (chest/shoulders/triceps)</option>
                        <option value="pullDay">Upper (Pull): 13 working sets (back/biceps)</option>
                        <option value="lower2">Lower 2: 9 working sets (free weight/unilateral legs)</option>
                        <option value="upperMixed">Upper: 14 working sets (mixed upper body)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h3>Tim's 18 Morning Questions</h3>
                <div id="morningQuestions"></div>
            </div>

            <div class="card">
                <h3>🔥 Today's Flame Selection</h3>
                <p><strong>Choose your challenge. Walk towards the fire that scares you most today.</strong></p>
                <div id="flameSelection"></div>
            </div>

            <div class="card">
                <button class="btn btn-primary" onclick="completeMorningRitual()">Complete Morning Ritual</button>
                <div id="morningStatus"></div>
            </div>
        </div>

        <!-- Daily Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <div class="card">
                <h2>⚡ Daily Accountability Dashboard</h2>
                <p><strong>Your foundation requirements. Check them off or explain why you're choosing failure.</strong></p>
                
                <div class="foundation-grid" id="foundationTracking">
                    <!-- Foundation items will be populated by JavaScript -->
                </div>

                <div id="accountabilityMessage"></div>
            </div>

            <div class="card">
                <h3>Integration Prompts</h3>
                <div class="foundation-item">
                    <span>Did you log your meals in MyFitnessPal today?</span>
                    <input type="checkbox" class="checkbox" id="myfitnesspal">
                </div>
                <div class="foundation-item">
                    <span>Did you complete your workout in Rep Count? (if training day)</span>
                    <input type="checkbox" class="checkbox" id="repcount">
                </div>
            </div>

            <div class="card">
                <h3>🔥 Today's Flame Progress</h3>
                <div id="todaysFlame">Select your flame in the Morning Ritual first.</div>
                <button class="btn btn-success" onclick="completeFlame()" id="flameCompleteBtn" style="display: none;">I Walked Through The Fire</button>
            </div>
        </div>

        <!-- Evening Ritual Tab -->
        <div id="evening" class="tab-content">
            <div class="card">
                <h2>🌙 Evening Ritual - Reflection & Scoring</h2>
                <p><strong>Time for brutal honesty. How did you perform today?</strong></p>
            </div>

            <div class="card">
                <h3>Tim's 6 Evening Questions</h3>
                <div id="eveningQuestions"></div>
            </div>

            <div class="card">
                <h3>Performance Domains (1-5 Scale)</h3>
                <div class="performance-grid" id="performanceScoring"></div>
            </div>

            <div class="card">
                <h3>Incomplete Task Accountability</h3>
                <div id="incompleteItems"></div>
            </div>

            <div class="card">
                <button class="btn btn-primary" onclick="completeEveningRitual()">Complete Evening Ritual</button>
            </div>
        </div>

        <!-- Night Planning Tab -->
        <div id="planning" class="tab-content">
            <div class="card">
                <h2>🎯 Night Planning - Tomorrow's Setup</h2>
                <p><strong>Plan tomorrow so you wake up with clarity, not confusion.</strong></p>
                
                <div class="question-group">
                    <label class="question-label">Tomorrow's Top 3 Must-Do Tasks:</label>
                    <textarea class="question-input" id="tomorrowTasks" placeholder="What absolutely must get done tomorrow?"></textarea>
                </div>

                <div class="question-group">
                    <label class="question-label">Tomorrow's Flame Preparation:</label>
                    <textarea class="question-input" id="tomorrowFlame" placeholder="Which flame category will challenge you most tomorrow?"></textarea>
                </div>

                <div class="question-group">
                    <label class="question-label">Clear Your Mind (dump any worries here):</label>
                    <textarea class="question-input" id="mindDump" placeholder="Get everything out of your head so you can sleep peacefully..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="completeNightPlanning()">Set Tomorrow & Sleep</button>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="export" class="tab-content">
            <div class="card">
                <h2>📊 Weekly Analysis Export</h2>
                <p><strong>Export your data for Claude coaching analysis and Tim integration.</strong></p>
                
                <div class="export-section">
                    <h3>Export Options</h3>
                    <button class="btn btn-primary" onclick="exportForClaude()">Export for Claude Analysis</button>
                    <button class="btn btn-primary" onclick="exportForTim()">Export for Tim (Questions Only)</button>
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
                </div>

                <div class="card">
                    <h3>Current Week Overview</h3>
                    <div id="weeklyOverview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Core Data Structure
        let appData = {
            currentWeight: 105,
            targetWeight: 98,
            dailyData: {},
            weeklyData: [],
            currentFlame: null,
            morningCompleted: false,
            eveningCompleted: false
        };

        // Tim's Questions
        const morningQuestions = [
            "Today's message to myself",
            "Today's top 3 goals/priorities", 
            "Tasks that absolutely must be done today",
            "Person(s) I need to connect with today (and how to do it well)",
            "Write a paragraph mapping out your perfect day today",
            "Where am I winning at the moment?",
            "3 things I'm grateful for today are?",
            "Today I will let go of?",
            "One thing I can get excited about today is?",
            "If one word could describe the kind of person I want to be today, then that word is... and why I chose it is...",
            "Someone who needs me on my A Game today is...",
            "A situation that might stress me out today or trip me up today could be... And the way my best self would deal with it is...",
            "Someone I could surprise with a gift, note or a sign of appreciation is...",
            "One action I could take today to demonstrate excellence or real value",
            "One bold action I could take today is...",
            "If I was my own performance coach looking at my life from a high level, I would tell myself to remember that...",
            "The big projects I have to keep in mind that I want to take on, even if I can't act towards them today, are...",
            "I would know that today was a great success if at the end of the day I did or felt these things..."
        ];

        const eveningQuestions = [
            "A moment that I really appreciated today was...",
            "A situation or a task I handled well today was...",
            "Something I realised or learned today was...",
            "I could have made today even better if I...",
            "Something that could have helped me feel more connected to others today would have been...",
            "If I was my own performance coach, I would tell myself this statement about myself..."
        ];

        const performanceDomains = [
            { key: 'clarity', name: 'CLARITY', description: 'I knew my "why" and lived intentionally today' },
            { key: 'energy', name: 'ENERGY', description: 'I managed my physical and mental energy well today' },
            { key: 'necessity', name: 'NECESSITY', description: 'I felt it was necessary to be my best and made success a "must"' },
            { key: 'productivity', name: 'PRODUCTIVITY', description: 'I worked on things that mattered most today' },
            { key: 'influence', name: 'INFLUENCE', description: 'I guided or treated others well today' },
            { key: 'courage', name: 'COURAGE', description: 'I shared my real self, thoughts, and feelings today' }
        ];

        const flameCategories = [
            {
                category: "Physical Foundation & Energy",
                statements: [
                    "Train to complete failure on all working sets",
                    "Choose the harder weight/rep when you could go easier", 
                    "Walk extra distance when you want to stop"
                ]
            },
            {
                category: "Nutrition & Energy Mastery", 
                statements: [
                    "Eat when stressed about business (biggest derail: not eating)",
                    "Choose planned meal over chocolate at night",
                    "Hit calorie targets when anxiety kills appetite"
                ]
            },
            {
                category: "Relationships & Connections",
                statements: [
                    "Have authentic conversation you've been avoiding",
                    "Be fully present with Cory instead of distracted",
                    "Express appreciation when it feels vulnerable"
                ]
            },
            {
                category: "Mindset & Identity",
                statements: [
                    "Journal about fear you're avoiding",
                    "Face truth you don't want to acknowledge", 
                    "Choose growth over comfort in decisions"
                ]
            },
            {
                category: "Precision Systems & Environmental",
                statements: [
                    "Organize something you've been procrastinating",
                    "Remove workflow friction that annoys you",
                    "Plan tomorrow instead of hoping it works out"
                ]
            },
            {
                category: "Business Liberation & Strategic Lifestyle",
                statements: [
                    "Have difficult client conversation today",
                    "Set boundaries with demanding clients",
                    "Make strategic decision you've been avoiding"
                ]
            },
            {
                category: "Financial Freedom & Worthiness",
                statements: [
                    "Make investment decision you've been researching (biggest concern: cashflow planning)",
                    "Have money conversation you're avoiding",
                    "Take action despite feeling \"not worthy\" of wealth"
                ]
            }
        ];

        // Foundation requirements
        const foundationItems = [
            { key: 'weight', name: 'Weight Logged', required: true },
            { key: 'calories', name: 'Calorie Target', required: true, dynamic: true },
            { key: 'training', name: 'Training Completed', required: false, trainingOnly: true },
            { key: 'steps', name: '10,000 Steps', required: true },
            { key: 'sleep', name: 'Sleep Logged', required: true },
            { key: 'journaling', name: 'Daily Journaling', required: true }
        ];

        // Stern accountability messages
        const accountabilityMessages = {
            training: "You're choosing weakness over strength. Your 3-year vision requires a disciplined body. What's more important - your comfort or your dreams?",
            tasks: "You made a commitment to yourself. Breaking promises to yourself is breaking promises to your future. Why are you sabotaging your own success?",
            nutrition: "Your body needs fuel to perform. Skipping meals because of business stress is choosing failure. Eat. Now.",
            general: "You're now behind on your own life. These aren't suggestions - they're requirements for the life you say you want.",
            steps: "Every step is a step towards your new life. Every missed step is a step towards mediocrity. Move your body. Move your life.",
            sleep: "Your recovery determines your performance tomorrow. Poor sleep = poor decisions = poor results. Prioritize your rest.",
            journaling: "Self-awareness creates self-mastery. Skipping journaling means you're operating blind. How can you improve what you don't track?"
        };

        // Initialize app
        function initApp() {
            loadData();
            updateTimeDisplay();
            renderMorningQuestions();
            renderFlameSelection();
            renderFoundationTracking();
            renderEveningQuestions();
            renderPerformanceScoring();
            updateWeightProgress();
            checkStepPrompts();
            
            // Set interval for time updates and step prompts
            setInterval(updateTimeDisplay, 1000);
            setInterval(checkStepPrompts, 60000); // Check every minute
        }

        function updateTimeDisplay() {
            const now = new Date();
            const timeString = now.toLocaleString('en-NZ', {
                weekday: 'long',
                year: 'numeric', 
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        function checkStepPrompts() {
            const now = new Date();
            const hour = now.getHours();
            const todayKey = now.toDateString();
            
            // Step prompts at 12pm and 5pm
            if ((hour === 12 || hour === 17) && now.getMinutes() === 0) {
                if (!appData.dailyData[todayKey]?.stepPromptShown) {
                    showStepPrompt();
                    if (!appData.dailyData[todayKey]) appData.dailyData[todayKey] = {};
                    appData.dailyData[todayKey].stepPromptShown = true;
                    saveData();
                }
            }
        }

        function showStepPrompt() {
            alert("🚨 STEP CHECK: Have you hit your 10,000 steps yet? Your transformation demands movement. Every step counts towards your new life. GET MOVING!");
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function renderMorningQuestions() {
            const container = document.getElementById('morningQuestions');
            container.innerHTML = '';
            
            morningQuestions.forEach((question, index) => {
                const div = document.createElement('div');
                div.className = 'question-group';
                div.innerHTML = `
                    <label class="question-label">${index + 1}. ${question}</label>
                    <textarea class="question-input" id="morning_q${index}" placeholder="Be honest and specific..."></textarea>
                `;
                container.appendChild(div);
            });
        }

        function renderEveningQuestions() {
            const container = document.getElementById('eveningQuestions');
            container.innerHTML = '';
            
            eveningQuestions.forEach((question, index) => {
                const div = document.createElement('div');
                div.className = 'question-group';
                div.innerHTML = `
                    <label class="question-label">${index + 1}. ${question}</label>
                    <textarea class="question-input" id="evening_q${index}" placeholder="Reflect deeply and honestly..."></textarea>
                `;
                container.appendChild(div);
            });
        }

        function renderFlameSelection() {
            const container = document.getElementById('flameSelection');
            container.innerHTML = '';
            
            flameCategories.forEach((category, catIndex) => {
                category.statements.forEach((statement, stmtIndex) => {
                    const div = document.createElement('div');
                    div.className = 'flame-card';
                    div.onclick = () => selectFlame(catIndex, stmtIndex, statement);
                    div.innerHTML = `
                        <div class="flame-category">${category.category}</div>
                        <div>${statement}</div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        function selectFlame(catIndex, stmtIndex, statement) {
            // Remove previous selection
            document.querySelectorAll('.flame-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new flame
            event.target.closest('.flame-card').classList.add('selected');
            appData.currentFlame = {
                category: flameCategories[catIndex].category,
                statement: statement,
                completed: false
            };
            
            updateTodaysFlame();
            saveData();
        }

        function updateTodaysFlame() {
            const container = document.getElementById('todaysFlame');
            if (appData.currentFlame) {
                container.innerHTML = `
                    <div class="flame-card selected">
                        <div class="flame-category">${appData.currentFlame.category}</div>
                        <div>${appData.currentFlame.statement}</div>
                        <div style="margin-top: 10px; font-weight: bold;">
                            Status: ${appData.currentFlame.completed ? '✅ CONQUERED' : '🔥 ACTIVE CHALLENGE'}
                        </div>
                    </div>
                `;
                
                const btn = document.getElementById('flameCompleteBtn');
                if (appData.currentFlame.completed) {
                    btn.style.display = 'none';
                } else {
                    btn.style.display = 'inline-block';
                }
            }
        }

        function completeFlame() {
            if (appData.currentFlame) {
                appData.currentFlame.completed = true;
                updateTodaysFlame();
                saveData();
                
                alert("🔥 FLAME CONQUERED! You walked through the fire and came out stronger. This is how transformation happens - one flame at a time.");
            }
        }

        function renderFoundationTracking() {
            const container = document.getElementById('foundationTracking');
            container.innerHTML = '';
            
            const todayKey = new Date().toDateString();
            const todayData = appData.dailyData[todayKey] || {};
            const isTrainingDay = document.getElementById('trainingDay')?.value === 'training';
            
            foundationItems.forEach(item => {
                if (item.trainingOnly && !isTrainingDay) return;
                
                const div = document.createElement('div');
                const isCompleted = todayData[item.key];
                const statusClass = isCompleted ? 'completed' : 'incomplete';
                
                let displayText = item.name;
                if (item.dynamic && item.key === 'calories') {
                    const target = isTrainingDay ? '2475' : '2223';
                    displayText = `${item.name} (${target} cal)`;
                }
                
                div.className = `foundation-item ${statusClass}`;
                div.innerHTML = `
                    <span>
                        <span class="status-indicator status-${isCompleted ? 'complete' : 'incomplete'}"></span>
                        ${displayText}
                    </span>
                    <input type="checkbox" class="checkbox" ${isCompleted ? 'checked' : ''} 
                           onchange="updateFoundationItem('${item.key}', this.checked)">
                `;
                container.appendChild(div);
            });
            
            checkAccountability();
        }

        function updateFoundationItem(key, completed) {
            const todayKey = new Date().toDateString();
            if (!appData.dailyData[todayKey]) {
                appData.dailyData[todayKey] = {};
            }
            
            appData.dailyData[todayKey][key] = completed;
            saveData();
            renderFoundationTracking();
        }

        function checkAccountability() {
            const todayKey = new Date().toDateString();
            const todayData = appData.dailyData[todayKey] || {};
            const isTrainingDay = document.getElementById('trainingDay')?.value === 'training';
            
            let missedItems = [];
            let completedCount = 0;
            let totalRequired = 0;
            
            foundationItems.forEach(item => {
                if (item.trainingOnly && !isTrainingDay) return;
                if (!item.required) return;
                
                totalRequired++;
                if (todayData[item.key]) {
                    completedCount++;
                } else {
                    missedItems.push(item.name);
                }
            });
            
            const container = document.getElementById('accountabilityMessage');
            
            if (missedItems.length >= 2) {
                // RED ALERT MODE
                container.innerHTML = `
                    <div class="accountability-alert">
                        🚨 RED ALERT MODE ACTIVATED 🚨<br>
                        You're now behind on your own life. These aren't suggestions - they're requirements for the life you say you want.<br>
                        Missing: ${missedItems.join(', ')}<br>
                        <strong>Fix this NOW or stay mediocre forever.</strong>
                    </div>
                `;
            } else if (missedItems.length === 1) {
                const missedItem = missedItems[0].toLowerCase();
                let message = accountabilityMessages.general;
                
                if (missedItem.includes('training')) message = accountabilityMessages.training;
                else if (missedItem.includes('calorie')) message = accountabilityMessages.nutrition;
                else if (missedItem.includes('steps')) message = accountabilityMessages.steps;
                else if (missedItem.includes('sleep')) message = accountabilityMessages.sleep;
                else if (missedItem.includes('journal')) message = accountabilityMessages.journaling;
                
                container.innerHTML = `
                    <div class="accountability-alert">
                        ⚠️ ACCOUNTABILITY WARNING ⚠️<br>
                        Missing: ${missedItems[0]}<br>
                        ${message}
                    </div>
                `;
            } else if (completedCount === totalRequired) {
                container.innerHTML = `
                    <div style="background-color: #d4a5a5; color: white; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold;">
                        ✅ FOUNDATION COMPLETE - You're living up to your commitments. This is how you build the life you want.
                    </div>
                `;
            }
        }

        function renderPerformanceScoring() {
            const container = document.getElementById('performanceScoring');
            container.innerHTML = '';
            
            performanceDomains.forEach(domain => {
                const div = document.createElement('div');
                div.className = 'performance-item';
                div.innerHTML = `
                    <h4>${domain.name}</h4>
                    <p style="font-size: 12px; margin: 5px 0;">${domain.description}</p>
                    <div class="rating-buttons">
                        ${[1,2,3,4,5].map(num => 
                            `<button class="rating-btn" onclick="setPerformanceRating('${domain.key}', ${num})">${num}</button>`
                        ).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function setPerformanceRating(domain, rating) {
            const todayKey = new Date().toDateString();
            if (!appData.dailyData[todayKey]) {
                appData.dailyData[todayKey] = {};
            }
            if (!appData.dailyData[todayKey].performance) {
                appData.dailyData[todayKey].performance = {};
            }
            
            appData.dailyData[todayKey].performance[domain] = rating;
            
            // Update UI
            const buttons = event.target.parentNode.querySelectorAll('.rating-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            saveData();
        }

        function completeMorningRitual() {
            // Collect morning data
            const todayKey = new Date().toDateString();
            if (!appData.dailyData[todayKey]) {
                appData.dailyData[todayKey] = {};
            }
            
            // Save morning questions
            const morningAnswers = {};
            morningQuestions.forEach((question, index) => {
                const answer = document.getElementById(`morning_q${index}`).value;
                morningAnswers[`q${index}`] = answer;
            });
            
            appData.dailyData[todayKey].morningQuestions = morningAnswers;
            appData.dailyData[todayKey].currentWeight = parseFloat(document.getElementById('currentWeight').value) || 105;
            appData.dailyData[todayKey].trainingDay = document.getElementById('trainingDay').value === 'training';
            appData.dailyData[todayKey].workoutType = document.getElementById('workoutType').value;
            appData.dailyData[todayKey].flameSelected = appData.currentFlame;
            
            appData.morningCompleted = true;
            appData.currentWeight = appData.dailyData[todayKey].currentWeight;
            
            updateWeightProgress();
            renderFoundationTracking();
            saveData();
            
            document.getElementById('morningStatus').innerHTML = `
                <div style="background-color: #d4a5a5; color: white; padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center;">
                    ✅ Morning Ritual Complete - Foundation set. Now execute with precision.
                </div>
            `;
            
            alert("Morning ritual complete! Your foundation is set. Now go execute with ruthless precision. No excuses, no shortcuts.");
        }

        function completeEveningRitual() {
            const todayKey = new Date().toDateString();
            if (!appData.dailyData[todayKey]) {
                appData.dailyData[todayKey] = {};
            }
            
            // Save evening questions
            const eveningAnswers = {};
            eveningQuestions.forEach((question, index) => {
                const answer = document.getElementById(`evening_q${index}`).value;
                eveningAnswers[`q${index}`] = answer;
            });
            
            appData.dailyData[todayKey].eveningQuestions = eveningAnswers;
            appData.eveningCompleted = true;
            
            // Check for incomplete foundation items
            renderIncompleteItems();
            saveData();
            
            alert("Evening ritual complete. Reflect, learn, improve. Tomorrow is another chance to exceed your own expectations.");
        }

        function renderIncompleteItems() {
            const container = document.getElementById('incompleteItems');
            const todayKey = new Date().toDateString();
            const todayData = appData.dailyData[todayKey] || {};
            const isTrainingDay = todayData.trainingDay;
            
            let incompleteItems = [];
            foundationItems.forEach(item => {
                if (item.trainingOnly && !isTrainingDay) return;
                if (!todayData[item.key]) {
                    incompleteItems.push(item.name);
                }
            });
            
            if (incompleteItems.length > 0) {
                container.innerHTML = `
                    <div style="background-color: #d2691e; color: white; padding: 15px; border-radius: 8px;">
                        <h4>Incomplete Items Requiring Explanation:</h4>
                        <ul style="margin: 10px 0;">
                            ${incompleteItems.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        <textarea class="question-input" placeholder="Why weren't these completed? What will you do differently tomorrow?" style="margin-top: 10px;"></textarea>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div style="background-color: #d4a5a5; color: white; padding: 15px; border-radius: 8px;">
                        ✅ All foundation items completed. Excellent execution.
                    </div>
                `;
            }
        }

        function completeNightPlanning() {
            const todayKey = new Date().toDateString();
            if (!appData.dailyData[todayKey]) {
                appData.dailyData[todayKey] = {};
            }
            
            appData.dailyData[todayKey].tomorrowTasks = document.getElementById('tomorrowTasks').value;
            appData.dailyData[todayKey].tomorrowFlame = document.getElementById('tomorrowFlame').value;
            appData.dailyData[todayKey].mindDump = document.getElementById('mindDump').value;
            
            saveData();
            alert("Tomorrow is planned. Your mind is clear. Sleep well and wake up ready to dominate.");
        }

        function updateWeightProgress() {
            const current = appData.currentWeight;
            const target = appData.targetWeight;
            const start = 105;
            const progress = Math.max(0, Math.min(100, ((start - current) / (start - target)) * 100));
            
            document.getElementById('weightProgress').textContent = 
                `Current: ${current}kg → Target: ${target}kg | Progress: ${progress.toFixed(1)}% Complete`;
        }

        function exportForClaude() {
            const exportData = {
                timestamp: new Date().toISOString(),
                currentWeight: appData.currentWeight,
                targetWeight: appData.targetWeight,
                dailyData: appData.dailyData,
                weeklyData: appData.weeklyData
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `hypertrophy-os-claude-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert("Data exported for Claude analysis. Upload this file to Claude for deep coaching insights and pattern analysis.");
        }

        function exportForTim() {
            const todayKey = new Date().toDateString();
            const todayData = appData.dailyData[todayKey] || {};
            
            const timData = {
                date: todayKey,
                morningQuestions: todayData.morningQuestions || {},
                eveningQuestions: todayData.eveningQuestions || {},
                flameSelected: todayData.flameSelected,
                performance: todayData.performance || {}
            };
            
            const dataStr = JSON.stringify(timData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `tim-cooper-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function clearAllData() {
            if (confirm("Are you sure you want to clear ALL data? This cannot be undone.")) {
                localStorage.removeItem('hypertrophy-os-data');
                appData = {
                    currentWeight: 105,
                    targetWeight: 98,
                    dailyData: {},
                    weeklyData: [],
                    currentFlame: null,
                    morningCompleted: false,
                    eveningCompleted: false
                };
                location.reload();
            }
        }

        function saveData() {
            localStorage.setItem('hypertrophy-os-data', JSON.stringify(appData));
        }

        function loadData() {
            const saved = localStorage.getItem('hypertrophy-os-data');
            if (saved) {
                appData = {...appData, ...JSON.parse(saved)};
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
